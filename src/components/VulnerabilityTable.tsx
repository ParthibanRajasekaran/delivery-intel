"use client";

import { motion } from "framer-motion";
import type { DependencyVulnerability } from "@/types";

interface VulnerabilityTableProps {
  vulnerabilities: DependencyVulnerability[];
}

const severityColors: Record<string, string> = {
  critical: "#ef4444",
  high: "#f97316",
  medium: "#eab308",
  low: "#3b82f6",
  unknown: "#8888a0",
};

export function VulnerabilityTable({
  vulnerabilities,
}: VulnerabilityTableProps) {
  return (
    <motion.div
      className="rounded-xl p-6 glass-card"
      initial={{ opacity: 0, x: 40 }}
      animate={{ opacity: 1, x: 0 }}
      transition={{ duration: 0.6, ease: [0.16, 1, 0.3, 1], delay: 0.1 }}
      whileHover={{ borderColor: "var(--accent)" }}
      style={{
        background: "var(--surface)",
        border: "1px solid var(--border)",
      }}
    >
      <div className="flex items-center justify-between mb-1">
        <h3 className="text-sm font-semibold">Vulnerability Scan</h3>
        <span
          className="text-xs font-medium px-2 py-0.5 rounded-full"
          style={{
            color:
              vulnerabilities.length === 0
                ? "var(--success)"
                : "var(--danger)",
            background:
              vulnerabilities.length === 0
                ? "rgba(34, 197, 94, 0.1)"
                : "rgba(239, 68, 68, 0.1)",
          }}
        >
          {vulnerabilities.length === 0
            ? "Clean"
            : `${vulnerabilities.length} found`}
        </span>
      </div>
      <p className="text-xs mb-4" style={{ color: "var(--text-muted)" }}>
        Powered by OSV.dev — scans package.json, requirements.txt, go.mod
      </p>

      {vulnerabilities.length === 0 ? (
        <div
          className="text-center py-8 rounded-lg"
          style={{ background: "var(--bg)" }}
        >
          <p className="text-sm" style={{ color: "var(--text-muted)" }}>
            ✓ No known vulnerabilities detected
          </p>
        </div>
      ) : (
        <div className="overflow-auto max-h-64">
          <table className="w-full text-xs">
            <thead>
              <tr
                style={{
                  borderBottom: "1px solid var(--border)",
                  color: "var(--text-muted)",
                }}
              >
                <th className="text-left py-2 pr-3 font-medium">Package</th>
                <th className="text-left py-2 pr-3 font-medium">Severity</th>
                <th className="text-left py-2 pr-3 font-medium">ID</th>
                <th className="text-left py-2 font-medium">Fix</th>
              </tr>
            </thead>
            <tbody>
              {vulnerabilities.slice(0, 20).map((v, i) => (
                <tr
                  key={`${v.vulnId}-${i}`}
                  style={{ borderBottom: "1px solid var(--border)" }}
                >
                  <td className="py-2 pr-3">
                    <span className="font-mono">{v.packageName}</span>
                    <span
                      className="ml-1"
                      style={{ color: "var(--text-muted)" }}
                    >
                      @{v.currentVersion}
                    </span>
                  </td>
                  <td className="py-2 pr-3">
                    <span
                      className="inline-block px-1.5 py-0.5 rounded text-[10px] font-semibold uppercase"
                      style={{
                        color: severityColors[v.severity],
                        background: `${severityColors[v.severity]}15`,
                      }}
                    >
                      {v.severity}
                    </span>
                  </td>
                  <td
                    className="py-2 pr-3 font-mono"
                    style={{ color: "var(--text-muted)" }}
                  >
                    {v.vulnId}
                  </td>
                  <td className="py-2">
                    {v.fixedVersion ? (
                      <span style={{ color: "var(--success)" }}>
                        → {v.fixedVersion}
                      </span>
                    ) : (
                      <span style={{ color: "var(--text-muted)" }}>—</span>
                    )}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
          {vulnerabilities.length > 20 && (
            <p
              className="text-xs mt-2 text-center"
              style={{ color: "var(--text-muted)" }}
            >
              + {vulnerabilities.length - 20} more
            </p>
          )}
        </div>
      )}
    </motion.div>
  );
}
